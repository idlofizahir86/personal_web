<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Table - Reksata Dialog</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
</head>
<body>
    <div class="container mt-4">
        <h2>Data Pesan Reksata Dialog</h2>
        <p>Halaman ini menampilkan data pesan yang telah dikumpulkan dari pengguna.</p>
        <table id="dataTable" class="table table-bordered">
            <thead>
                <tr>
                    <th>No</th>
                    <th>Intent</th>
                    <th>Message</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    
    <footer class="text-center mt-4 p-3 bg-light">
        <p>LinkedIn: <a href="https://www.linkedin.com/in/idlofi-zahir-rajaba/" target="_blank">Idlofi Zahir Rajaba</a></p>
        <p>GitHub: <a href="https://github.com/idlofizahir86/" target="_blank">idlofizahir86</a></p>
        <p><small>Website ini tidak digunakan untuk kepentingan komersial. Dibuat untuk keperluan eksperimen dan pengembangan.</small></p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getDatabase, ref, get, remove } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAGTrcgg0bUGS8nS11uUsfU_5ymkNY_dZ8",
            authDomain: "reksata-dialog.firebaseapp.com",
            databaseURL: "https://reksata-dialog-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "reksata-dialog",
            storageBucket: "reksata-dialog.appspot.com",
            messagingSenderId: "1048714287798",
            appId: "1:1048714287798:web:b183831c52549a0404e417"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        $(document).ready(function () {
            loadTable();
        });

        function loadTable() {
            get(ref(db, 'messages')).then(snapshot => {
                if (snapshot.exists()) {
                    let data = snapshot.val();
                    let tableBody = '';
                    let index = 1;
                    
                    for (let key in data) {
                        let row = data[key];
                        tableBody += `<tr>
                            <td>${index++}</td>
                            <td>${row.intent}</td>
                            <td>${row.message}</td>
                            <td><button class='btn btn-danger btn-sm' onclick='deleteData("${key}")'>ðŸ—‘</button></td>
                        </tr>`;
                    }

                    $('#dataTable tbody').html(tableBody);
                    $('#dataTable').DataTable();
                }
            }).catch(error => console.error("Gagal mengambil data:", error));
        }

        window.deleteData = function (key) {
            if (confirm("Apakah Anda yakin ingin menghapus data ini?")) {
                remove(ref(db, `messages/${key}`)).then(() => {
                    alert("Data berhasil dihapus!");
                    location.reload();
                }).catch(error => console.error("Gagal menghapus data:", error));
            }
        }
    </script>
</body>
</html>
